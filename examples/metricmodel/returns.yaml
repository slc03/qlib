# 初始化，传入数据集地址
qlib_init:
    provider_uri: "./.data/qlib_data"
    region: cn

# 设置股票池/基准等全局超参数
market: &market all
benchmark: &benchmark 000010.SZ
start_time: &start_time 2022-09-30
end_time: &end_time 2025-09-29
experiment_name: exp-test
recorder_name: record-1

# 数据处理配置
data_handler_config: &data_handler_config
    fields: ["open", "close"]
    instruments: *market
    start_time: *start_time
    end_time: *end_time
    fit_start_time: *start_time
    fit_end_time: *end_time

# 组合分析配置
port_analysis_config: &port_analysis_config
    strategy:
        class: TopkDropoutStrategy
        module_path: qlib.contrib.strategy
        kwargs:
            signal: <PRED>
            topk: 5
            n_drop: 2
    backtest:
        start_time: *start_time
        end_time: *end_time
        account: 100000
        benchmark: *benchmark
        exchange_kwargs:
            limit_threshold: 0.095
            deal_price: close
            open_cost: 0.0005
            close_cost: 0.0015
            min_cost: 5

# 任务配置
task:
    # 使用的模型
    model:
        class: ReturnsModel
        module_path: qlib.contrib.metric
        kwargs:
            windows: 3
    # 使用的数据集
    dataset:
        class: DatasetH
        module_path: qlib.data.dataset
        kwargs:
            handler:
                class: OrdinaryDataHandler
                module_path: qlib.contrib.data.handler
                kwargs: *data_handler_config
            segments:
                test: [*start_time, *end_time]
    # 记录配置
    record: 
        - class: SignalRecord
          module_path: qlib.workflow.record_temp
          kwargs: 
            model: <MODEL>
            dataset: <DATASET>
        - class: SigAnaRecord
          module_path: qlib.workflow.record_temp
          kwargs: 
            ana_long_short: False
            ann_scaler: 252
        - class: PortAnaRecord
          module_path: qlib.workflow.record_temp
          kwargs: 
            config: *port_analysis_config
            risk_analysis_freq: day
